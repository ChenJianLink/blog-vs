<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>修改站长信息页面</title>
    <link rel="stylesheet" type="text/css" href="https://chenjianlink-1258070985.file.myqcloud.com/static/jquery-easyui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="https://chenjianlink-1258070985.file.myqcloud.com/static/jquery-easyui/themes/icon.css">
    <link rel="stylesheet" type="text/css" th:href="@{/css/imgPreview.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/eazyui-style.css}">
    <script type="text/javascript" src="https://chenjianlink-1258070985.file.myqcloud.com/static/jquery-easyui/jquery.min.js"></script>
    <script type="text/javascript" src="https://chenjianlink-1258070985.file.myqcloud.com/static/jquery-easyui/jquery.easyui.min.js"></script>
    <script type="text/javascript" src="https://chenjianlink-1258070985.file.myqcloud.com/static/jquery-easyui/locale/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" charset="UTF-8" th:src="@{/ueditor/ueditor.config.js}"></script>
    <script type="text/javascript" charset="UTF-8" th:src="@{/ueditor/ueditor.all.min.js}"></script>
    <!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
    <!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
    <script type="text/javascript" charset="UTF-8" th:src="@{/ueditor/lang/zh-cn/zh-cn.js}"></script>

    <script type="text/javascript">

        function submitData() {
            var nickName = $("#nickName").val();
            var sign = $("#sign").val();
            var profile = UE.getEditor('profile').getContent();

            if (nickName == null || nickName == '') {
                $.messager.alert("系统提示", "请输入昵称！", "warning");
            } else if (sign == null || sign == '') {
                $.messager.alert("系统提示", "请输入个性签名！", "warning");
            } else if (profile == null || profile == '') {
                $.messager.alert("系统提示", "请输入个性简介！", "warning");
            } else {
                $("#pF").val(profile);
                $.ajax(
                    {
                        url: '/admin/bloggerManage/blogger',
                        type: 'PUT',
                        cache: false,
                        data: new FormData($('#form1')[0]),
                        processData: false,
                        contentType: false,
                        success: function (result) {
                            if (result.status != 500 && result.errorInfo != null) {
                                $.messager.alert("系统提示", result.errorInfo);
                            } else if (result.status == 500) {
                                $.messager.alert("系统提示", "站长信息修改失败", "error");
                            } else {
                                $.messager.alert("系统提示", "站长信息修改成功", "info");
                            }
                            $("#imageFile").val("");
                        },
                        error: function () {
                            $.messager.alert("系统提示", "站长信息修改失败", "error");
                            $("#imageFile").val("");
                        }
                    });
            }
        }

        function changepic() {
            $("#prompt3").css("display", "none");
            var reads = new FileReader();
            var f = document.getElementById('imageFile').files[0];
            reads.readAsDataURL(f);
            reads.onload = function(e) {
                document.getElementById('img3').src = this.result;
                $("#img3").css("display", "block");
            };
        }

        function changeImage() {
            $("#imageFile").click();
        }
    </script>

</head>
<body style="margin: 1px;background-image: url('https://chenjianlink-1258070985.file.myqcloud.com/static/images/background/bloggerInfoBackground.jpg');background-size:cover">
<div id="p" class="easyui-panel" style="padding: 10px" data-options="fit:true">
    <form id="form1" enctype="multipart/form-data" style="width: auto">
        <table cellspacing="20px">
            <tr>
                <td width="80px">用户名：</td>
                <td>
                    <input type="hidden" id="id" name="id"/>
                    <input type="text" id="userName" name="userName"
                           style="width: 200px;background-color:rgba(250,250,250,0)" readonly="readonly"/>
                </td>
            </tr>
            <tr>
                <td>昵称：</td>
                <td><input type="text" id="nickName" name="nickName"
                           style="width: 200px;background-color:rgba(250,250,250,0)"/></td>
            </tr>
            <tr>
                <td>个性签名：</td>
                <td><input type="text" id="sign" name="sign"
                           style="width: 400px;background-color:rgba(250,250,250,0)"/></td>
            </tr>
            <tr>
                <td>个人头像：</td>
                <td>
                    <div id="imgPreview">
                        <div id="prompt3">
                            <span id="imgSpan">
                                点击上传<br/>
                                <img th:src="@{/images/add.png}" style="width: 40%;height: auto">
                            </span>
                            <input type="file" id="imageFile" class="filepath" name="imageFile" onchange="changepic(this)" accept="image/jpg,image/jpeg,image/png,image/PNG,image/ico,image/bmp,image/gif">
                            <!--当vaule值改变时执行changepic函数，规定上传的文件只能是图片-->
                        </div>
                        <img src="#" id="img3" onclick="changeImage()"/>
                    </div>
                </td>
            </tr>
            <tr>
                <td valign="top">个人简介：</td>
                <td>
                    <script id="profile" type="text/plain" style="width:100%;height:500px;"></script>
                    <input type="hidden" id="pF" name="profile"/>
                </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <a href="javascript:submitData()" class="easyui-linkbutton"
                       data-options="iconCls:'icon-submit'">提交</a>
                </td>
            </tr>
        </table>
    </form>
</div>

<script type="text/javascript">
    //实例化编辑器
    //建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
    var ue = UE.getEditor('profile');

    ue.addListener("ready", function () {
        //通过ajax请求数据
        UE.ajax.request("/admin/bloggerManage/blogger",
            {
                method: "get",
                async: false,
                data: {},
                onsuccess: function (result) {
                    result = eval("(" + result.responseText + ")");
                    $("#id").val(result.id);
                    $("#userName").val(result.userName);
                    $("#nickName").val(result.nickName);
                    $("#sign").val(result.sign);
                    UE.getEditor('profile').setContent(result.profile);
                }
            }
        );
    });
</script>
</body>
</html>